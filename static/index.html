<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/style.css">
    <title>网盘资源助手2</title>
    <script src="/static/js/script.js"></script>
<style>
    /* 资源条目样式 */
    .resource-entry {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 12px;
        background: white;
        position: relative;
    }
    
    /* 主资源标记 */
    .main-resource::after {
        content: "精准匹配";
        position: absolute;
        top: 10px;
        right: 10px;
        background: #07C160;
        color: white;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 12px;
    }
    
    .resource-title {
        font-size: 16px;
        font-weight: bold;
        color: #333;
        margin-bottom: 8px;
    }
    
    .resource-meta {
        color: #666;
        font-size: 14px;
        margin: 6px 0;
    }
    
    .action-buttons {
        display: flex;
        gap: 8px;
        margin-top: 10px;
    }
    
    .action-btn {
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
    }
    
    .update-btn {
        background: #ff9800;
        color: white;
    }
    
    .feedback-btn {
        background: #ff5722;
        color: white;
    }
    
    .copy-btn {
        background: #4285f4;
        color: white;
    }
    
    /* 分隔线 */
    .divider {
        border-top: 1px dashed #e0e0e0;
        margin: 15px 0;
    }
</style>
</head>
<body>
    <div class="chat-header">
        <div class="back-btn">←</div>
        <div>网盘资源助手</div>
    </div>
    
    <div class="chat-container" id="chat-container">
        <!-- 初始欢迎消息 -->
        <div class="message bot-message">
            <img src="https://via.placeholder.com/40/07C160/FFFFFF?text=Bot" class="avatar" alt="助手头像">
            <div class="message-content">
                <div class="nickname">网盘助手</div>
                <div class="bubble bot-bubble">
                    你好！我是网盘资源助手，可以帮你查找各种网盘资源。<br>
                    请输入你想搜索的资源名称，例如：<br>
                    <em>"我是传奇 电影"</em> 或 <em>"Python编程入门"</em>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-container">
        <input 
            type="text" 
            id="chat-input" 
            placeholder="输入你想搜索的资源..."
            autocomplete="off"
        >
        <button id="send-button">发送</button>
    </div>

 <script>
    // 更新消息处理逻辑
    async function handleSendMessage() {
        const keyword = chatInput.value.trim();
        if (!keyword) return;
        
        addUserMessage(keyword);
        chatInput.value = '';
        
        const typingElement = showTyping();
        
        try {
            const data = await sendSearchRequest(keyword);
            
            // 移除正在输入状态
            chatContainer.removeChild(typingElement);
            
            if (data.error) {
                addBotMessage(`<div class="error-message">${data.error}</div>`);
                return;
            }
            
            // 处理结果
            let html = '';
            if (data.results && data.results.length > 0) {
                html = data.results.map(item => `
                    <div class="resource-item">
                        <div class="resource-title">${item.title}</div>
                        <div class="resource-meta">
                            <span>链接：百度网盘</span>
                            <span class="resource-pwd">提取码：${item.password}</span>
                        </div>
                        <div class="action-buttons">
                            <button class="update-btn">每日更新库</button>
                            <button class="feedback-btn">失效反馈</button>
                            <button class="copy-btn" onclick="copyToClipboard('${item.url}')">复制链接</button>
                        </div>
                    </div>
                `).join('');
            } else {
                html = '<div class="no-results">没有找到相关资源</div>';
            }
            
            addBotMessage(html);
            
        } catch (error) {
            chatContainer.removeChild(typingElement);
            addBotMessage(`
                <div class="error-message">
                    <p>请求失败: ${error.message}</p>
                    <p>可能原因：</p>
                    <ul>
                        <li>网络连接问题</li>
                        <li>服务器暂时不可用</li>
                        <li>目标网站反爬机制</li>
                    </ul>
                    <button onclick="retrySearch('${keyword}')">重试</button>
                </div>
            `);
        }
    }
    
    // 重试函数
    function retrySearch(keyword) {
        addUserMessage(`(重试) ${keyword}`);
        handleSendMessage();
    }
</script>

<style>
    /* 更新样式以匹配图1 */
    .resource-item {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 12px;
        background: white;
    }
    
    .resource-title {
        font-size: 16px;
        font-weight: bold;
        color: #333;
        margin-bottom: 8px;
    }
    
    .resource-meta {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        font-size: 14px;
    }
    
    .resource-pwd {
        margin-left: 15px;
        color: #666;
    }
    
    .action-buttons {
        display: flex;
        gap: 8px;
    }
    
    .update-btn {
        background: #ff9800;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
    }
    
    .feedback-btn {
        background: #9e9e9e;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
    }
    
    .copy-btn {
        background: #4285f4;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
    }
    
    .error-message {
        background: #ffebee;
        padding: 12px;
        border-radius: 8px;
        color: #c62828;
    }
</style>
</body>
</html>
